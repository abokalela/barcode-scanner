<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ماسح الباركود</title>
<style>
body{margin:0;padding:0;font-family:"Segoe UI",sans-serif;background:#000;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;overflow:hidden;}
video{width:100%;height:auto;max-height:90vh;border-radius:12px;}
button{margin-top:10px;padding:10px 20px;border:none;border-radius:8px;background:#0b6fb2;color:#fff;font-size:16px;font-weight:bold;}
</style>
</head>
<body>
<video id="preview" autoplay playsinline></video>
<button id="closeBtn">إغلاق</button>
<script src="https://unpkg.com/@zxing/library@latest"></script>
<script>
const codeReader = new ZXing.BrowserMultiFormatReader();
const preview = document.getElementById('preview');
const closeBtn = document.getElementById('closeBtn');

const constraints = {
  video: {
    facingMode: { exact: "environment" },
    width: { ideal: 1920 },
    height: { ideal: 1080 }
  }
};

codeReader.decodeFromVideoDevice(null, 'preview', (result, err) => {
  if (result) {
    window.opener.postMessage({ barcode: result.text }, '*');
    window.close();
  }
});

navigator.mediaDevices.getUserMedia(constraints)
  .then(stream => preview.srcObject = stream)
  .catch(() => alert("تعذر الوصول للكاميرا. تأكد من السماح للتطبيق بالوصول."));

closeBtn.onclick = () => window.close();
</script>
</body>
</html>
