<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>ماسح الباركود</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; margin:0; padding:0; background:#f5f5f5; }
#video { width:100%; max-width:500px; margin-top:20px; border-radius:12px; }
#result { margin-top:20px; font-size:1.2em; font-weight:bold; color:#054a7a; }
button { margin-top:20px; padding:10px 20px; font-size:16px; border:none; border-radius:8px; background:#0b6fb2; color:white; cursor:pointer; }
</style>
</head>
<body>
<h2>ماسح الباركود</h2>
<video id="video" autoplay playsinline></video>
<div id="result">جاري المسح...</div>
<button onclick="stopScan()">إيقاف المسح</button>

<script src="https://unpkg.com/@zxing/library@0.19.1/umd/index.min.js"></script>
<script>
const codeReader = new ZXing.BrowserBarcodeReader();
const videoElement = document.getElementById('video');
const resultDiv = document.getElementById('result');

async function startScan() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
    videoElement.srcObject = stream;

    codeReader.decodeFromVideoDevice(null, videoElement, (result, err) => {
      if (result) {
        resultDiv.textContent = "تم العثور على الكود: " + result.text;
        // هنا يمكن إرسال النتيجة تلقائيًا إلى Google Sheet أو أي مكان
        console.log(result.text);
        // لإيقاف المسح تلقائيًا بعد قراءة الكود
        stopScan();
      }
      if (err && !(err instanceof ZXing.NotFoundException)) {
        console.error(err);
      }
    });
  } catch (e) {
    resultDiv.textContent = "حدث خطأ في الوصول إلى الكاميرا: " + e;
  }
}

function stopScan() {
  codeReader.reset();
  if(videoElement.srcObject){
    videoElement.srcObject.getTracks().forEach(track => track.stop());
  }
  resultDiv.textContent += " [تم الإيقاف]";
}

startScan();
</script>
</body>
</html>
